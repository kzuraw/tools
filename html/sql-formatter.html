<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SQL Formatter - sqlstyle.guide</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üõ†Ô∏è</text></svg>">
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Helvetica",
          "Arial", sans-serif;
        background: #f5f5f5;
        color: #1a1a1a;
        padding: 40px 20px;
        min-height: 100vh;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 40px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      h1 {
        font-size: 28px;
        margin-bottom: 8px;
        color: #1a1a1a;
        font-weight: 600;
      }

      .subtitle {
        font-size: 14px;
        color: #666;
        margin-bottom: 32px;
      }

      .subtitle a {
        color: #0066cc;
        text-decoration: none;
      }

      .subtitle a:hover {
        text-decoration: underline;
      }

      label {
        display: block;
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 8px;
        color: #1a1a1a;
      }

      textarea {
        width: 100%;
        min-height: 200px;
        padding: 12px;
        background: #fafafa;
        border: 1px solid #d1d1d1;
        border-radius: 6px;
        color: #1a1a1a;
        font-family: "SF Mono", "Monaco", "Consolas", monospace;
        font-size: 13px;
        line-height: 1.6;
        resize: vertical;
        margin-bottom: 20px;
      }

      textarea:focus {
        outline: none;
        border-color: #0066cc;
        background: #fff;
      }

      .options {
        display: flex;
        gap: 24px;
        margin-bottom: 24px;
      }

      .checkbox-wrapper {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .checkbox-wrapper input[type="checkbox"] {
        width: 16px;
        height: 16px;
        cursor: pointer;
      }

      .checkbox-wrapper label {
        margin: 0;
        font-weight: 400;
        font-size: 14px;
        cursor: pointer;
      }

      .actions {
        display: flex;
        gap: 12px;
      }

      button {
        padding: 10px 20px;
        background: #0066cc;
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: background 0.2s;
      }

      button:hover {
        background: #0055b3;
      }

      button:active {
        transform: translateY(1px);
      }

      .copy-btn,
      .clear-btn {
        background: #e5e5e5;
        color: #1a1a1a;
      }

      .copy-btn:hover,
      .clear-btn:hover {
        background: #d4d4d4;
      }

      footer {
        margin-top: 40px;
        padding-top: 20px;
        text-align: center;
        color: #666;
        font-size: 14px;
      }

      footer a {
        color: #0066cc;
        text-decoration: none;
        margin: 0 10px;
      }

      footer a:hover {
        text-decoration: underline;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>SQL Formatter</h1>
      <div class="subtitle">
        Formats SQL according to
        <a href="https://www.sqlstyle.guide/" target="_blank">sqlstyle.guide</a>
      </div>

      <label for="input">Paste SQL Query</label>
      <textarea
        id="input"
        placeholder="Paste your SQL query here..."
      ></textarea>

      <div class="options">
        <div class="checkbox-wrapper">
          <input type="checkbox" id="indent" checked />
          <label for="indent">Auto Indent</label>
        </div>
        <div class="checkbox-wrapper">
          <input type="checkbox" id="newlines" checked />
          <label for="newlines">New Lines for Clauses</label>
        </div>
      </div>

      <label for="output">Formatted SQL</label>
      <textarea
        id="output"
        readonly
        placeholder="Formatted SQL will appear here"
      ></textarea>

      <div class="actions">
        <button onclick="formatSQL()">Format SQL</button>
        <button class="copy-btn" onclick="copyOutput()">
          Copy to Clipboard
        </button>
        <button class="clear-btn" onclick="clearAll()">Clear</button>
      </div>
    </div>

    <script>
      function formatSQL() {
        const input = document.getElementById("input").value;
        const indent = document.getElementById("indent").checked;
        const newlines = document.getElementById("newlines").checked;

        const formatted = formatSQLString(input, indent, newlines);
        document.getElementById("output").value = formatted;
      }

      function formatSQLString(sql, indent, newlines) {
        if (!sql.trim()) return "";

        // Remove extra whitespace and normalize
        sql = sql.trim().replace(/\s+/g, " ");

        // Keywords to uppercase (always applied)
        const keywords = [
          "SELECT",
          "FROM",
          "WHERE",
          "JOIN",
          "LEFT",
          "RIGHT",
          "INNER",
          "OUTER",
          "ON",
          "AND",
          "OR",
          "NOT",
          "IN",
          "EXISTS",
          "BETWEEN",
          "LIKE",
          "IS",
          "NULL",
          "ORDER BY",
          "GROUP BY",
          "HAVING",
          "LIMIT",
          "OFFSET",
          "INSERT",
          "INTO",
          "VALUES",
          "UPDATE",
          "SET",
          "DELETE",
          "CREATE",
          "TABLE",
          "ALTER",
          "DROP",
          "INDEX",
          "VIEW",
          "PRIMARY KEY",
          "FOREIGN KEY",
          "REFERENCES",
          "CONSTRAINT",
          "AS",
          "DISTINCT",
          "CASE",
          "WHEN",
          "THEN",
          "ELSE",
          "END",
          "UNION",
          "INTERSECT",
          "EXCEPT",
          "WITH",
          "INT",
          "VARCHAR",
          "TEXT",
          "TIMESTAMP",
          "BOOLEAN",
          "BOOL",
          "DATE",
          "SERIAL",
          "BIGSERIAL",
          "NUMERIC",
          "DECIMAL",
          "REAL",
          "DOUBLE PRECISION",
          "GENERATED ALWAYS",
          "AS IDENTITY",
          "WITH TIME ZONE",
          "WITHOUT TIME ZONE",
          "NOT NULL",
          "DEFAULT",
          "CHECK",
          "UNIQUE",
          "TRUE",
          "FALSE",
          "NOW",
          "DATE_TRUNC",
          "INTERVAL",
          "COALESCE",
          "CAST",
        ];

        // Sort by length (longest first) to handle multi-word keywords
        keywords.sort((a, b) => b.length - a.length);

        keywords.forEach((keyword) => {
          const regex = new RegExp(`\\b${keyword}\\b`, "gi");
          sql = sql.replace(regex, keyword.toUpperCase());
        });

        // Handle CREATE TABLE formatting
        if (sql.toUpperCase().includes("CREATE TABLE")) {
          return formatCreateTable(sql, indent);
        }

        // Handle SELECT statements
        if (sql.toUpperCase().includes("SELECT") && newlines) {
          return formatSelect(sql);
        }

        // Basic formatting for other statements
        return sql;
      }

      function formatCreateTable(sql, indent) {
        // Extract table name and columns
        const createMatch = sql.match(/CREATE\s+TABLE\s+(\w+)\s*\((.*)\)/is);
        if (!createMatch) return sql;

        const tableName = createMatch[1];
        const columnsStr = createMatch[2];

        // Split columns by comma (but not within parentheses)
        const columns = splitColumns(columnsStr);

        if (!indent) {
          return `CREATE TABLE ${tableName} (\n${columns.map((c) => "    " + c.trim()).join(",\n")}\n)`;
        }

        // Find the longest column name for alignment
        const maxColLength = Math.max(
          ...columns.map((col) => {
            const match = col.trim().match(/^(\w+)/);
            return match ? match[1].length : 0;
          }),
        );

        // Format each column
        const formattedColumns = columns.map((col) => {
          col = col.trim();
          const parts = col.split(/\s+/);
          const colName = parts[0];
          const rest = parts.slice(1).join(" ");

          // Pad column name
          const padding = " ".repeat(maxColLength - colName.length);
          return `    ${colName}${padding} ${rest}`;
        });

        return `CREATE TABLE ${tableName} (\n${formattedColumns.join(",\n")}\n)`;
      }

      function formatSelect(sql) {
        let result = sql;

        // Add newlines before major clauses
        result = result.replace(
          /\s+(FROM|WHERE|JOIN|LEFT JOIN|RIGHT JOIN|INNER JOIN|ORDER BY|GROUP BY|HAVING|LIMIT)\s+/gi,
          (match) => `\n${match.trim().toUpperCase()} `,
        );

        // Indent JOINs
        result = result.replace(
          /\n(LEFT|RIGHT|INNER)?\s*JOIN/gi,
          "\n     JOIN",
        );
        result = result.replace(/\nLEFT JOIN/gi, "\n LEFT JOIN");
        result = result.replace(/\nRIGHT JOIN/gi, "\nRIGHT JOIN");
        result = result.replace(/\nINNER JOIN/gi, "\nINNER JOIN");

        return result;
      }

      function splitColumns(str) {
        const columns = [];
        let current = "";
        let parenDepth = 0;

        for (let i = 0; i < str.length; i++) {
          const char = str[i];
          if (char === "(") parenDepth++;
          if (char === ")") parenDepth--;

          if (char === "," && parenDepth === 0) {
            columns.push(current);
            current = "";
          } else {
            current += char;
          }
        }

        if (current.trim()) {
          columns.push(current);
        }

        return columns;
      }

      function copyOutput() {
        const output = document.getElementById("output");
        output.select();
        document.execCommand("copy");

        const btn = event.target;
        const originalText = btn.textContent;
        btn.textContent = "Copied!";
        setTimeout(() => {
          btn.textContent = originalText;
        }, 2000);
      }

      function clearAll() {
        document.getElementById("input").value = "";
        document.getElementById("output").value = "";
      }

      // Auto-format on input
      document.getElementById("input").addEventListener("input", () => {
        formatSQL();
      });

      // Auto-format when options change
      document.getElementById("indent").addEventListener("change", formatSQL);
      document.getElementById("newlines").addEventListener("change", formatSQL);
    </script>

    <footer>
      <a href="../index.html">Home</a> |
      <a href="https://github.com/kzuraw/tools">Source Code</a> |
      <a href="https://kzuraw.com">kzuraw.com</a>
    </footer>
  </body>
</html>
